///////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Copyright (C) 2020 HanvonUgee Technology Corp. All rights reserved.
//FileName: Xy_calibration.c
//Brief:X Y coordinate calibration
//Platform:GD32F350xxx
//Ver: V1.0.0
//Date:2020.07.15
//Author: 
//Modify: Felix_wang
//  1.????
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////////////////////////
#include "digitizer_comm.h"
#include "digitizer_api.h"
#include "xy_calibration.h"


///////////////////////////////////////////////////////////////////////////////////////////////////////////////
#define CorX 151
#define CorY  90


///////////////////////////////////////////////////////////////////////////////////////////////////////////////
void calibration_X(void)
{
    unsigned short int   temp1;
    
    if(pos_calc.X  < correction_x[0])//0x3ee)     //less than the leftest edge
    {
        pos_calc.X = correction_x[0];//0x3ee;   //assign the left edge value to it.
    }
    else if(pos_calc.X  > correction_x[CorX-1])
    {
        pos_calc.X = correction_x[CorX-1]+ X_offset;
    }
    else
    for(temp1=0;temp1<CorX-1;temp1++)
    {
        if((pos_calc.X > correction_x[temp1]) && (pos_calc.X <= correction_x[temp1+1]))
        {
            pos_calc.X = (pos_calc.X - correction_x[temp1]) * PIXEL_PER2MM / (correction_x[temp1+1] - correction_x[temp1]) + (correction_x[0] + PIXEL_PER2MM * temp1);
            temp1 = CorX-1; //equals break;
        }

    }
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////
void calibration_Y(void)
{
    unsigned short int temp1;
    
    if(pos_calc.Y < correction_y[0])//0x3ee)
    {
        pos_calc.Y = correction_y[0];//0x3ee;
    }
    else if(pos_calc.Y  > correction_y[CorY-1])
    {
        pos_calc.Y = correction_y[CorY-1] + Y_offset;
    }
    else
        //caution: it may have index out of bound problem.
    for(temp1=0;temp1<CorY-1;temp1++)
    {
        if((pos_calc.Y > correction_y[temp1]) && (pos_calc.Y <= correction_y[temp1+1]))
        {
            pos_calc.Y = (pos_calc.Y - correction_y[temp1]) * PIXEL_PER2MM / (correction_y[temp1+1] - correction_y[temp1]) + (correction_y[0] + PIXEL_PER2MM * temp1);
            temp1 = CorY-1;  //equals break;
        }
    }
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////
unsigned const int correction_x[CorX] = 
{


    1465,
    1595,
    1739,
    1871,
    2019,
    2306,
    2667,
    3049,
    3424,
    3814,
    4213,
    4612,
    5012,
    5411,
    5810,
    6209,
    6608,
    7008,
    7407,
    7806,
    8205,
    8604,
    9003,
    9403,
    9802,
    10201,
    10600,
    10999,
    11399,
    11798,
    12197,
    12596,
    12995,
    13395,
    13794,
    14193,
    14592,
    14991,
    15391,
    15790,
    16189,
    16588,
    16987,
    17386,
    17786,
    18185,
    18584,
    18983,
    19382,
    19782,
    20181,
    20580,
    20979,
    21378,
    21778,
    22177,
    22576,
    22975,
    23374,
    23774,
    24173,
    24572,
    24971,
    25370,
    25769,
    26169,
    26568,
    26967,
    27366,
    27765,
    28165,
    28564,
    28963,
    29362,
    29761,
    30161,
    30560,
    30959,
    31358,
    31757,
    32156,
    32556,
    32955,
    33354,
    33753,
    34152,
    34552,
    34951,
    35350,
    35749,
    36148,
    36548,
    36947,
    37346,
    37745,
    38144,
    38544,
    38943,
    39342,
    39741,
    40140,
    40539,
    40939,
    41338,
    41737,
    42136,
    42535,
    42935,
    43334,
    43733,
    44132,
    44531,
    44931,
    45330,
    45729,
    46128,
    46527,
    46927,
    47326,
    47725,
    48124,
    48523,
    48922,
    49322,
    49721,
    50120,
    50519,
    50918,
    51318,
    51717,
    52116,
    52515,
    52914,
    53314,
    53713,
    54112,
    54511,
    54910,
    55310,
    55709,
    56108,
    56507,
    56896,
    57247,
    57638,
    57971,
    58206,
    58347,
    58493,
    58622,
    58734


};

unsigned const int correction_y[CorY] = 
{
    1626,
    1782,
    1960,
    2233,
    2549,
    2875,
    3227,
    3603,
    3973,
    4354,
    4752,
    5151,
    5549,
    5947,
    6346,
    6744,
    7142,
    7540,
    7939,
    8337,
    8735,
    9134,
    9532,
    9930,
    10329,
    10727,
    11125,
    11524,
    11922,
    12320,
    12719,
    13117,
    13515,
    13913,
    14312,
    14710,
    15108,
    15507,
    15905,
    16303,
    16702,
    17100,
    17498,
    17897,
    18295,
    18693,
    19091,
    19490,
    19888,
    20286,
    20685,
    21083,
    21481,
    21880,
    22278,
    22676,
    23075,
    23473,
    23871,
    24270,
    24668,
    25066,
    25464,
    25863,
    26261,
    26659,
    27058,
    27456,
    27854,
    28253,
    28651,
    29049,
    29448,
    29846,
    30244,
    30642,
    31041,
    31439,
    31837,
    32236,
    32634,
    33023,
    33391,
    33748,
    34070,
    34406,
    34769,
    35053,
    35253,
    35419

};
